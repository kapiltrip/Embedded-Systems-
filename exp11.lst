


ARM Macro Assembler    Page 1 


    1 00000000         ;=====================================================
    2 00000000         ; Traffic Light Controller (Sample) - ARM7 Big Endian
    3 00000000         ; Uses a single RO AREA like your working experiments
    4 00000000         ; RED -> bit0, YEL -> bit1, GRN -> bit2 of PORT variable
                       
    5 00000000         ; Watch variable: PORT (add to Logic Analyzer)
    6 00000000         ;=====================================================
    7 00000000         
    8 00000000                 AREA             SAMPLE, CODE, READONLY
    9 00000000                 EXPORT           _start
   10 00000000                 ENTRY
   11 00000000         
   12 00000000 00000001 
                       RED     EQU              0x1         ; bit 0
   13 00000000 00000002 
                       YEL     EQU              0x2         ; bit 1
   14 00000000 00000004 
                       GRN     EQU              0x4         ; bit 2
   15 00000000         
   16 00000000         _start
   17 00000000         ; R1 holds &PORT, R0 the pattern we write
   18 00000000 E59F10B0        LDR              r1, =PORT
   19 00000004 E3A00000        MOV              r0, #0
   20 00000008 E5810000        STR              r0, [r1]    ; clear PORT
   21 0000000C EB000013        BL               update_signals ; mirror bits fo
                                                            r Logic Analyzer
   22 00000010         
   23 00000010         main_loop
   24 00000010         ; ---- GREEN (long) ----
   25 00000010 E3A00004        MOV              r0, #GRN
   26 00000014 E5810000        STR              r0, [r1]
   27 00000018 EB000010        BL               update_signals
   28 0000001C E59F4098        LDR              r4, =DELAY_LONG
   29 00000020 EB00000A        BL               delay
   30 00000024         
   31 00000024         ; ---- YELLOW (short) ----
   32 00000024 E3A00002        MOV              r0, #YEL
   33 00000028 E5810000        STR              r0, [r1]
   34 0000002C EB00000B        BL               update_signals
   35 00000030 E59F4088        LDR              r4, =DELAY_SHORT
   36 00000034 EB000005        BL               delay
   37 00000038         
   38 00000038         ; ---- RED (long) ----
   39 00000038 E3A00001        MOV              r0, #RED
   40 0000003C E5810000        STR              r0, [r1]
   41 00000040 EB000006        BL               update_signals
   42 00000044 E59F4070        LDR              r4, =DELAY_LONG
   43 00000048 EB000000        BL               delay
   44 0000004C         
   45 0000004C EAFFFFEF        B                main_loop
   46 00000050         
   47 00000050         ;---------------------------------------
   48 00000050         ; delay: busy-wait, r4 holds &count word
   49 00000050         ;---------------------------------------
   50 00000050         delay
   51 00000050 E5945000        LDR              r5, [r4]    ; r5 = loop count
   52 00000054         delay_loop
   53 00000054 E2555001        SUBS             r5, r5, #1
   54 00000058 1AFFFFFD        BNE              delay_loop



ARM Macro Assembler    Page 2 


   55 0000005C E12FFF1E        BX               lr
   56 00000060         
   57 00000060         ;---------------------------------------
   58 00000060         ; update_signals: mirror PORT bits to
   59 00000060         ; SIG_RED/YEL/GRN (0/1 words) for LA
   60 00000060         ; Input: r0 = current PORT pattern
   61 00000060         ; Clobbers: r2, r3
   62 00000060         ;---------------------------------------
   63 00000060         update_signals
   64 00000060         ; RED
   65 00000060 E59F205C        LDR              r2, =SIG_RED
   66 00000064 E3100001        TST              r0, #RED
   67 00000068 03A03000        MOVEQ            r3, #0
   68 0000006C 13A03001        MOVNE            r3, #1
   69 00000070 E5823000        STR              r3, [r2]
   70 00000074         ; YEL
   71 00000074 E59F204C        LDR              r2, =SIG_YEL
   72 00000078 E3100002        TST              r0, #YEL
   73 0000007C 03A03000        MOVEQ            r3, #0
   74 00000080 13A03001        MOVNE            r3, #1
   75 00000084 E5823000        STR              r3, [r2]
   76 00000088         ; GRN
   77 00000088 E59F203C        LDR              r2, =SIG_GRN
   78 0000008C E3100004        TST              r0, #GRN
   79 00000090 03A03000        MOVEQ            r3, #0
   80 00000094 13A03001        MOVNE            r3, #1
   81 00000098 E5823000        STR              r3, [r2]
   82 0000009C E12FFF1E        BX               lr
   83 000000A0         
   84 000000A0                 ALIGN
   85 000000A0 00000000 
                       PORT    DCD              0           ; watched variable 
                                                            (bits 2:0)
   86 000000A4         
   87 000000A4         ; Individual logic-analyzer-friendly signals (0/1)
   88 000000A4 00000000 
                       SIG_RED DCD              0
   89 000000A8 00000000 
                       SIG_YEL DCD              0
   90 000000AC 00000000 
                       SIG_GRN DCD              0
   91 000000B0         
   92 000000B0         ; Tune these if too fast/slow
   93 000000B0 002DC6C0 
                       DELAY_LONG
                               DCD              3000000
   94 000000B4 00124F80 
                       DELAY_SHORT
                               DCD              1200000
   95 000000B8         
   96 000000B8                 END
              00000000 
              00000000 
              00000000 
              00000000 
              00000000 
              00000000 
              00000000 
Command Line: --debug --xref --bi --apcs=interwork --depend=exp11.d -oexp11.o -



ARM Macro Assembler    Page 3 


IC:\Keil\ARM\RV31\INC -IC:\Keil\ARM\CMSIS\Include --predefine="__EVAL SETA 1" -
-list=exp11.lst exp11.asm



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

DELAY_LONG 000000B0

Symbol: DELAY_LONG
   Definitions
      At line 93 in file exp11.asm
   Uses
      At line 28 in file exp11.asm
      At line 42 in file exp11.asm

DELAY_SHORT 000000B4

Symbol: DELAY_SHORT
   Definitions
      At line 94 in file exp11.asm
   Uses
      At line 35 in file exp11.asm
Comment: DELAY_SHORT used once
PORT 000000A0

Symbol: PORT
   Definitions
      At line 85 in file exp11.asm
   Uses
      At line 18 in file exp11.asm
Comment: PORT used once
SAMPLE 00000000

Symbol: SAMPLE
   Definitions
      At line 8 in file exp11.asm
   Uses
      None
Comment: SAMPLE unused
SIG_GRN 000000AC

Symbol: SIG_GRN
   Definitions
      At line 90 in file exp11.asm
   Uses
      At line 77 in file exp11.asm
Comment: SIG_GRN used once
SIG_RED 000000A4

Symbol: SIG_RED
   Definitions
      At line 88 in file exp11.asm
   Uses
      At line 65 in file exp11.asm
Comment: SIG_RED used once
SIG_YEL 000000A8

Symbol: SIG_YEL
   Definitions
      At line 89 in file exp11.asm
   Uses
      At line 71 in file exp11.asm
Comment: SIG_YEL used once
_start 00000000




ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

Symbol: _start
   Definitions
      At line 16 in file exp11.asm
   Uses
      At line 9 in file exp11.asm
Comment: _start used once
delay 00000050

Symbol: delay
   Definitions
      At line 50 in file exp11.asm
   Uses
      At line 29 in file exp11.asm
      At line 36 in file exp11.asm
      At line 43 in file exp11.asm

delay_loop 00000054

Symbol: delay_loop
   Definitions
      At line 52 in file exp11.asm
   Uses
      At line 54 in file exp11.asm
Comment: delay_loop used once
main_loop 00000010

Symbol: main_loop
   Definitions
      At line 23 in file exp11.asm
   Uses
      At line 45 in file exp11.asm
Comment: main_loop used once
update_signals 00000060

Symbol: update_signals
   Definitions
      At line 63 in file exp11.asm
   Uses
      At line 21 in file exp11.asm
      At line 27 in file exp11.asm
      At line 34 in file exp11.asm
      At line 41 in file exp11.asm

12 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

GRN 00000004

Symbol: GRN
   Definitions
      At line 14 in file exp11.asm
   Uses
      At line 25 in file exp11.asm
      At line 78 in file exp11.asm

RED 00000001

Symbol: RED
   Definitions
      At line 12 in file exp11.asm
   Uses
      At line 39 in file exp11.asm
      At line 66 in file exp11.asm

YEL 00000002

Symbol: YEL
   Definitions
      At line 13 in file exp11.asm
   Uses
      At line 32 in file exp11.asm
      At line 72 in file exp11.asm

3 symbols
348 symbols in table
